AV.initialize("2guystre6l7mftvlgm8tm2vsj2mrtgrgm68wx9lgfzg2xj23","r4q9f3iq899amkz1eaksicsi8smrkymc3esvkz7hiu3bl8k2");var UserInfo=AV.Object.extend("UserInfo"),ExchangeNote=AV.Object.extend("ExchangeNote"),LightRecord=AV.Object.extend("LightRecord"),saveUserInfo=function(e,n){var t=new UserInfo;t.save(e,{success:function(e){n(null,e)}})},queryUserInfo=function(e,n){var t=new AV.Query(UserInfo);t.equalTo("user_id",e.userId),t.find({success:function(e){n(null,e)},error:function(e){alert("Error: "+e.code+" "+e.message)}})},updateUserInfo=function(e,n){var t=new AV.Query(UserInfo);t.get(e.objectId,{success:function(t){t.increment("word"+e.wordNum),t.save(),n(null,t)},error:function(e,n){alert(n.message)}})},addExchangeNote=function(e){var n=new ExchangeNote;n.save(e,{success:function(e){console.log("添加兑换码成功！")}})},queryOneExchangeNote=function(e,n){var t=new AV.Query(ExchangeNote);t.equalTo("isExchange",!1),t.first({success:function(t){n(null,t),t.set("isExchange",!0),t.set("exchangeUser",e),updateExchangeNote(t)},error:function(e){alert("Error: "+e.code+" "+e.message)}})},queryExchangeNumByOpenid=function(e,n){var t=new AV.Query(ExchangeNote);t.equalTo("exchangeUser",e),t.find({success:function(e){n(null,e)},error:function(e){alert("Error: "+e.code+" "+e.message)}})},updateExchangeNote=function(e){var n=new AV.Query(ExchangeNote);n.get(e.id,{success:function(n){n.save(e,{success:function(e){console.log("exchangenote update!")}})},error:function(e,n){alert(n.message)}})},addLightRecord=function(e,n){var t=new LightRecord;t.save(e,{success:function(e){n(null,e)},error:function(e,n){alert("Failed to create new object, with error message: "+n.message)}})},queryLightRecord=function(e,n){AV.Query.doCloudQuery("select * from LightRecord where user_id=? and friend_id=?",[e.userId,e.friendId],{success:function(e){var t=e.results,r=t[0];if(r){var o=new Date,c=isSameDay(r.get("light_date"),o);c?(r.set("can_vote",!1),r.sameDay=!1):(r.set("can_vote",!0),r.sameDay=!1)}else r={can_vote:!0,sameDay:!0,get:function(){return this.can_vote}};n(null,r)},error:function(e){alert(e.message)}})},updateLightRecord=function(e,n){var t=AV.Object.extend("LightRecord"),r=new AV.Query(t);r.get(e.id,{success:function(e){e.set("light_count",e.get("light_count")+1),e.set("light_date",new Date),e.save(),n(null,e)},error:function(e,n){console.log(e)}})},isSameDay=function(e,n){return e.getYear()!=n.getYear()?!1:e.getMonth()!=n.getMonth()?!1:e.getDay()!=n.getDay()?!1:!0};